import{_ as n,o as s,c as a,e as t}from"./app-1Zj3YMQE.js";const p={},e=t(`<h1 id="direct3d9入门绘制" tabindex="-1"><a class="header-anchor" href="#direct3d9入门绘制"><span>Direct3D9入门绘制</span></a></h1><p>整个中国对于D3D相关的资料几乎是0，学习成本极其艰巨，为数不多的英语学习书籍也都是主讲3D，用到了很多的3D数学知识。对于2D绘制需求来说学习起来性价比极低，所以专门写了这样一篇D3D9快速入门。</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建"><span>环境搭建</span></a></h2><p>首先要安装Direct3D9的SDK，地址：https://www.microsoft.com/zh-cn/download/details.aspx?id=6812</p><p>下载成功后在VS中导入include和lib目录，目的是拿到，include目录中的d3d9.h、d3dx9.h以及lib目录下的d3d9.lib和d3dx9.lib</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321000410789.png" alt="image-20240321000410789"></p><h2 id="窗口创建" tabindex="-1"><a class="header-anchor" href="#窗口创建"><span>窗口创建</span></a></h2><p>首先要熟悉WIN32应用窗口创建文档：https://learn.microsoft.com/zh-cn/windows/win32/learnwin32/winmain--the-application-entry-point，因为我们的Direct3D窗口是基于Windows窗口上面绘制的。</p><p>先将程序入口由控制台改为窗口</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321000538437.png" alt="image-20240321000538437"></p><p>此时，应用程序入口为WinMain函数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> WINAPI <span class="token function">WinMain</span><span class="token punctuation">(</span>HINSTANCE hInstance<span class="token punctuation">,</span> HINSTANCE hPrevInstance<span class="token punctuation">,</span>PSTR lpCmdLine<span class="token punctuation">,</span> <span class="token keyword">int</span> nCmdShow<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>了解创建窗口参数WNDCLASS类</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">tagWNDCLASSA</span> <span class="token punctuation">{</span>
  UINT      style<span class="token punctuation">;</span>
  WNDPROC   lpfnWndProc<span class="token punctuation">;</span> <span class="token comment">//指向窗口过程的指针</span>
  <span class="token keyword">int</span>       cbClsExtra<span class="token punctuation">;</span>
  <span class="token keyword">int</span>       cbWndExtra<span class="token punctuation">;</span>
  HINSTANCE hInstance<span class="token punctuation">;</span> <span class="token comment">//入口实例</span>
  HICON     hIcon<span class="token punctuation">;</span> <span class="token comment">//图标</span>
  HCURSOR   hCursor<span class="token punctuation">;</span> <span class="token comment">//游标</span>
  HBRUSH    hbrBackground<span class="token punctuation">;</span> <span class="token comment">//背景颜色</span>
  LPCSTR    lpszMenuName<span class="token punctuation">;</span> <span class="token comment">//菜单</span>
  LPCSTR    lpszClassName<span class="token punctuation">;</span> <span class="token comment">//类名</span>
<span class="token punctuation">}</span> WNDCLASSA<span class="token punctuation">,</span> <span class="token operator">*</span>PWNDCLASSA<span class="token punctuation">,</span> <span class="token operator">*</span>NPWNDCLASSA<span class="token punctuation">,</span> <span class="token operator">*</span>LPWNDCLASSA<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>style为窗口风格，如下所示：</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321001122856.png" alt="image-20240321001122856"></p><p>这里要详细了解下lpfnWndProc的定义，后续所有的窗口消息都会传递给Wndproc的第二个参数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>LRESULT <span class="token function">Wndproc</span><span class="token punctuation">(</span>
  HWND unnamedParam1<span class="token punctuation">,</span> <span class="token comment">//窗口句柄</span>
  UINT unnamedParam2<span class="token punctuation">,</span> <span class="token comment">//系统消息列表</span>
  WPARAM unnamedParam3<span class="token punctuation">,</span> <span class="token comment">//其他消息信息</span>
  LPARAM unnamedParam4 <span class="token comment">//其他消息信息</span>
<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>故我们注册一个自己的窗口WNDCLASS类</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>WNDCLASS wc<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>style <span class="token operator">=</span> CS_VREDRAW <span class="token operator">|</span> CS_HREDRAW<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>lpfnWndProc <span class="token operator">=</span> <span class="token punctuation">(</span>WNDPROC<span class="token punctuation">)</span>Wndproc<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>cbClsExtra <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>cbWndExtra <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hInstance <span class="token operator">=</span> hInstance<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hIcon <span class="token operator">=</span> <span class="token function">LoadIcon</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> IDI_APPLICATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hCursor <span class="token operator">=</span> <span class="token function">LoadCursor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> IDC_ARROW<span class="token punctuation">)</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hbrBackground <span class="token operator">=</span> <span class="token punctuation">(</span>HBRUSH<span class="token punctuation">)</span><span class="token function">GetStockObject</span><span class="token punctuation">(</span>WHITE_BRUSH<span class="token punctuation">)</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>lpszMenuName <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>lpszClassName <span class="token operator">=</span> <span class="token string">&quot;ClassName&quot;</span><span class="token punctuation">;</span>
<span class="token function">RegisterClass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来了解创建窗口的函数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>HWND <span class="token function">CreateWindowA</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  lpClassName<span class="token punctuation">,</span> <span class="token comment">//类名</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  lpWindowName<span class="token punctuation">,</span> <span class="token comment">//标题名</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            dwStyle<span class="token punctuation">,</span> <span class="token comment">//窗口风格</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            x<span class="token punctuation">,</span> <span class="token comment">//x坐标</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            y<span class="token punctuation">,</span> <span class="token comment">//y坐标</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            nWidth<span class="token punctuation">,</span> <span class="token comment">//窗口宽度</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            nHeight<span class="token punctuation">,</span> <span class="token comment">//窗口高度</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  hWndParent<span class="token punctuation">,</span> <span class="token comment">//父窗口句柄</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  hMenu<span class="token punctuation">,</span> <span class="token comment">//菜单句柄</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  hInstance<span class="token punctuation">,</span> <span class="token comment">//入口实例</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  lpParam <span class="token comment">//传递到窗口的值的指针</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>于是可以创建一个宽和高都为400的窗口</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>HWND hwnd <span class="token operator">=</span> <span class="token function">CreateWindowA</span><span class="token punctuation">(</span><span class="token string">&quot;ClassName&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;窗口标题&quot;</span><span class="token punctuation">,</span>WS_OVERLAPPEDWINDOW<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>wc<span class="token punctuation">.</span>hInstance<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="窗口绘制" tabindex="-1"><a class="header-anchor" href="#窗口绘制"><span>窗口绘制</span></a></h2><p>有了Win32应用窗口，接下来就可以使用Direct3D对窗口进行操作绘制了。</p><p>首先，创建一个D3D9指针，随后再创建一个caps，以及D3D9的参数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>IDirect3D9<span class="token operator">*</span> d3d9 <span class="token operator">=</span> <span class="token function">Direct3DCreate9</span><span class="token punctuation">(</span>D3D_SDK_VERSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
D3DCAPS9 caps<span class="token punctuation">;</span>
d3d9<span class="token operator">-&gt;</span><span class="token function">GetDeviceCaps</span><span class="token punctuation">(</span>D3DADAPTER_DEFAULT<span class="token punctuation">,</span> D3DDEVTYPE_HAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>caps<span class="token punctuation">)</span><span class="token punctuation">;</span>
D3DPRESENT_PARAMETERS d3dpp<span class="token punctuation">;</span>
<span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d3dpp<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>d3dpp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d3dpp<span class="token punctuation">.</span>Windowed <span class="token operator">=</span> TRUE<span class="token punctuation">;</span> <span class="token comment">//窗口化</span>
d3dpp<span class="token punctuation">.</span>SwapEffect <span class="token operator">=</span> D3DSWAPEFFECT_DISCARD<span class="token punctuation">;</span>
d3dpp<span class="token punctuation">.</span>BackBufferFormat <span class="token operator">=</span> D3DFMT_UNKNOWN<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>随后我们使用d3d9创建一个全局的d3d设备，IDirect3DDevice9* g_device;</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>d3d9<span class="token operator">-&gt;</span><span class="token function">CreateDevice</span><span class="token punctuation">(</span>D3DADAPTER_DEFAULT<span class="token punctuation">,</span> D3DDEVTYPE_HAL<span class="token punctuation">,</span> hwnd<span class="token punctuation">,</span> D3DCREATE_SOFTWARE_VERTEXPROCESSING<span class="token punctuation">,</span> <span class="token operator">&amp;</span>d3dpp<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_device<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>有了win32窗口，有了d3d设备，我们现在要将窗口显示出来。并且循环读入消息。</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token function">ShowWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">UpdateWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">;</span> 
MSG msg<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">,</span>hwnd<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">TranslateMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DispatchMessageA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将消息调度到窗口过程</span>
<span class="token punctuation">}</span>
<span class="token function">UnregisterClass</span><span class="token punctuation">(</span><span class="token string">&quot;ClassName&quot;</span><span class="token punctuation">,</span> wc<span class="token punctuation">.</span>hInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321003642348.png" alt="image-20240321003642348"></p><p>此时我们可以看到一个背景为白色，长宽都为400的窗口。接下来我们只需要对窗口过程WndProc进行编写绘制过程就可以了。</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>VOID <span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> g_device<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	g_device<span class="token operator">-&gt;</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> D3DCLEAR_TARGET<span class="token punctuation">,</span> <span class="token function">D3DCOLOR_ARGB</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">SUCCEEDED</span><span class="token punctuation">(</span>g_device<span class="token operator">-&gt;</span><span class="token function">BeginScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		g_device<span class="token operator">-&gt;</span><span class="token function">EndScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	g_device<span class="token operator">-&gt;</span><span class="token function">Present</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
VOID <span class="token function">CleanUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>g_device <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		g_device<span class="token operator">-&gt;</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
LRESULT WINAPI <span class="token function">Wndproc</span><span class="token punctuation">(</span>
	HWND hwnd<span class="token punctuation">,</span>
	UINT msg<span class="token punctuation">,</span>
	WPARAM wParam<span class="token punctuation">,</span>
	LPARAM lParam
<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	<span class="token keyword">case</span> WM_DESTROY<span class="token operator">:</span>
        <span class="token function">CleanUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">PostQuitMessage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> WM_PAINT<span class="token operator">:</span>
		<span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ValidateRect</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">DefWindowProc</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> wParam<span class="token punctuation">,</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上Wndproc实现了窗口接收到销毁消息WM_DESTROY时，执行CleanUp函数释放d3d设备。并且实现了窗口接收到绘制消息时，调用d3d设备进行Clear绘制，将窗口底色绘制成ARGB(0,255,200,0)。</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321003734267.png" alt="image-20240321003734267"></p><h2 id="输出文字" tabindex="-1"><a class="header-anchor" href="#输出文字"><span>输出文字</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">//绘制字体</span>
<span class="token keyword">char</span> font<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;微软雅黑&quot;</span><span class="token punctuation">;</span>
<span class="token function">D3DXCreateFont</span><span class="token punctuation">(</span>
	g_device<span class="token punctuation">,</span>
	<span class="token number">40</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>
	FW_BOLD<span class="token punctuation">,</span>
	<span class="token number">1</span><span class="token punctuation">,</span>
	FALSE<span class="token punctuation">,</span>
	DEFAULT_CHARSET<span class="token punctuation">,</span>
	OUT_DEFAULT_PRECIS<span class="token punctuation">,</span>
	DEFAULT_QUALITY<span class="token punctuation">,</span>
	DEFAULT_PITCH<span class="token operator">|</span>FF_DONTCARE<span class="token punctuation">,</span>
	font<span class="token punctuation">,</span> <span class="token comment">//pFaceName</span>
	<span class="token operator">&amp;</span>g_font
<span class="token punctuation">)</span><span class="token punctuation">;</span>
RECT rc<span class="token punctuation">;</span>
<span class="token function">SetRect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_font<span class="token operator">-&gt;</span><span class="token function">DrawTextA</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;输出文字啊啊啊啊阿&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rc<span class="token punctuation">,</span> DT_NOCLIP<span class="token punctuation">,</span> <span class="token function">D3DXCOLOR</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制矩形" tabindex="-1"><a class="header-anchor" href="#绘制矩形"><span>绘制矩形</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">//绘制矩形</span>
D3DRECT d3dRect <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">240</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d3dRect<span class="token punctuation">,</span> D3DCLEAR_TARGET<span class="token punctuation">,</span> <span class="token function">D3DCOLOR_XRGB</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制三角形" tabindex="-1"><a class="header-anchor" href="#绘制三角形"><span>绘制三角形</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">//绘制三角形</span>
LPDIRECT3DVERTEXBUFFER9 g_pVB <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token comment">//三个点的信息</span>
CUSTOMVERTEX vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token punctuation">{</span><span class="token number">150.f</span><span class="token punctuation">,</span><span class="token number">50.f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">1.0f</span><span class="token punctuation">,</span><span class="token number">0xffff0000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">250.0f</span><span class="token punctuation">,</span><span class="token number">250.0f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">1.0f</span><span class="token punctuation">,</span><span class="token number">0xff00ff00</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">50.0f</span><span class="token punctuation">,</span><span class="token number">250.0f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">1.0f</span><span class="token punctuation">,</span><span class="token number">0xff00ff00</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">CreateVertexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CUSTOMVERTEX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  D3DFVF_XYZRHW<span class="token operator">|</span>D3DFVF_DIFFUSE<span class="token punctuation">,</span> D3DPOOL_DEFAULT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pVB<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
VOID<span class="token operator">*</span> pVertices<span class="token punctuation">;</span>
g_pVB<span class="token operator">-&gt;</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>pVertices<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memcpy</span><span class="token punctuation">(</span>pVertices<span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_pVB<span class="token operator">-&gt;</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">SetStreamSource</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> g_pVB<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>CUSTOMVERTEX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">SetFVF</span><span class="token punctuation">(</span>D3DFVF_XYZRHW <span class="token operator">|</span> D3DFVF_DIFFUSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">DrawPrimitive</span><span class="token punctuation">(</span>D3DPT_TRIANGLELIST<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制直线" tabindex="-1"><a class="header-anchor" href="#绘制直线"><span>绘制直线</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token function">D3DXCreateLine</span><span class="token punctuation">(</span>g_device<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绘制直线</span>
D3DXVECTOR2 Vertex<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
g_Line<span class="token operator">-&gt;</span><span class="token function">SetWidth</span><span class="token punctuation">(</span><span class="token number">5.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_Line<span class="token operator">-&gt;</span><span class="token function">Draw</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token function">D3DCOLOR_XRGB</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更复杂的3D及动态绘制我也仍在学习阶段，这些就是基本的绘制操作，足以应付外挂编写的基本需求了。</p></blockquote>`,46),c=[e];function o(i,u){return s(),a("div",null,c)}const k=n(p,[["render",o],["__file","Direct3D9入门绘制.html.vue"]]),d=JSON.parse('{"path":"/blog/Direct3D9%E5%85%A5%E9%97%A8%E7%BB%98%E5%88%B6.html","title":"Direct3D9入门绘制","lang":"en-US","frontmatter":{"title":"Direct3D9入门绘制","date":"2024-03-20T00:00:00.000Z","category":["History"],"tag":["Windows","游戏开发"]},"headers":[{"level":2,"title":"环境搭建","slug":"环境搭建","link":"#环境搭建","children":[]},{"level":2,"title":"窗口创建","slug":"窗口创建","link":"#窗口创建","children":[]},{"level":2,"title":"窗口绘制","slug":"窗口绘制","link":"#窗口绘制","children":[]},{"level":2,"title":"输出文字","slug":"输出文字","link":"#输出文字","children":[]},{"level":2,"title":"绘制矩形","slug":"绘制矩形","link":"#绘制矩形","children":[]},{"level":2,"title":"绘制三角形","slug":"绘制三角形","link":"#绘制三角形","children":[]},{"level":2,"title":"绘制直线","slug":"绘制直线","link":"#绘制直线","children":[]}],"git":{"updatedTime":1711214483000,"contributors":[{"name":"wqby","email":"9479421@qq.com","commits":1}]},"filePathRelative":"blog/Direct3D9入门绘制.md","excerpt":"\\n<p>整个中国对于D3D相关的资料几乎是0，学习成本极其艰巨，为数不多的英语学习书籍也都是主讲3D，用到了很多的3D数学知识。对于2D绘制需求来说学习起来性价比极低，所以专门写了这样一篇D3D9快速入门。</p>\\n<h2>环境搭建</h2>\\n<p>首先要安装Direct3D9的SDK，地址：https://www.microsoft.com/zh-cn/download/details.aspx?id=6812</p>\\n<p>下载成功后在VS中导入include和lib目录，目的是拿到，include目录中的d3d9.h、d3dx9.h以及lib目录下的d3d9.lib和d3dx9.lib</p>"}');export{k as comp,d as data};
