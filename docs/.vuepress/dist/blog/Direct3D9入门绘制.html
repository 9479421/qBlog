<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <title>Direct3D9入门绘制 | 不良人</title><meta name="description" content="My first VuePress Site">
    <link rel="preload" href="/assets/style-BV2aNBet.css" as="style"><link rel="stylesheet" href="/assets/style-BV2aNBet.css">
    <link rel="modulepreload" href="/assets/app-CC-6zdNz.js"><link rel="modulepreload" href="/assets/Direct3D9入门绘制.html-Dm5ddngU.js">
    <link rel="prefetch" href="/assets/get-started.html-DFHLAETI.js" as="script"><link rel="prefetch" href="/assets/index.html-BGrutZy2.js" as="script"><link rel="prefetch" href="/assets/C__实现微信自动跳一跳.html-l7ty-JEM.js" as="script"><link rel="prefetch" href="/assets/C__调用JS代码.html-DO_iF2AK.js" as="script"><link rel="prefetch" href="/assets/CloudFlare以及防DDOS策略详述.html-NjOo6eZu.js" as="script"><link rel="prefetch" href="/assets/NDK开发so调用so.html-C5-CbRK3.js" as="script"><link rel="prefetch" href="/assets/Surface使用体验与RD_frp搭建.html-DmDYGEib.js" as="script"><link rel="prefetch" href="/assets/TinyWebServer手撸记录.html-0baCpQRL.js" as="script"><link rel="prefetch" href="/assets/X职通APP算法破解记录.html-KVIwWeDz.js" as="script"><link rel="prefetch" href="/assets/内层CALL追局部变量.html-C_bUHBOj.js" as="script"><link rel="prefetch" href="/assets/当Yolo成为外挂.html-CC9QXgcH.js" as="script"><link rel="prefetch" href="/assets/微信小程序逆向教程.html-CvDTH0E3.js" as="script"><link rel="prefetch" href="/assets/手机浏览器调试方法.html-6BmkZJC7.js" as="script"><link rel="prefetch" href="/assets/指定窗口句柄截图.html-BJUBbxVN.js" as="script"><link rel="prefetch" href="/assets/最低成本的方式搭建ChatGpt接口.html-CltWK2Js.js" as="script"><link rel="prefetch" href="/assets/某付费文档网破解记录.html-D2V-TOGm.js" as="script"><link rel="prefetch" href="/assets/栈溢出漏洞分析.html-DAzetf4a.js" as="script"><link rel="prefetch" href="/assets/网游喊话加密Call分析.html-BmA1t-Gj.js" as="script"><link rel="prefetch" href="/assets/网游链表数据遍历.html-DY2iN4wF.js" as="script"><link rel="prefetch" href="/assets/index.html-nSY5t4oL.js" as="script"><link rel="prefetch" href="/assets/index.html-HNSz13WT.js" as="script"><link rel="prefetch" href="/assets/index.html-1umNTfA-.js" as="script"><link rel="prefetch" href="/assets/index.html-C6r_8A1L.js" as="script"><link rel="prefetch" href="/assets/《第一行代码》学习笔记.html-DuYOZxkq.js" as="script"><link rel="prefetch" href="/assets/Linux服务器编程.html-DwkeSOLS.js" as="script"><link rel="prefetch" href="/assets/VS修改编码格式为UTF-8.html-4cWMsqII.js" as="script"><link rel="prefetch" href="/assets/vs未能正确加载XX包的解决方法.html-BzXVTNok.js" as="script"><link rel="prefetch" href="/assets/易道云学习笔记.html-ny7fUZbY.js" as="script"><link rel="prefetch" href="/assets/Git学习笔记.html-B1tLqQ2O.js" as="script"><link rel="prefetch" href="/assets/Java加密库的签名问题解决记录.html-CX0bTh5H.js" as="script"><link rel="prefetch" href="/assets/《疯狂JAVA讲义》学习笔记.html-CJlH-NNr.js" as="script"><link rel="prefetch" href="/assets/动力节点NIO学习笔记.html-CSFXqrlB.js" as="script"><link rel="prefetch" href="/assets/SSH服务与VS连接失败解决方案.html-DtxKqexi.js" as="script"><link rel="prefetch" href="/assets/易道云-Linux系统命令.html-vaVcX5Wg.js" as="script"><link rel="prefetch" href="/assets/狂神说Linux.html-Cwfn_9xo.js" as="script"><link rel="prefetch" href="/assets/Docker学习笔记.html-kuiNzoz2.js" as="script"><link rel="prefetch" href="/assets/Docker部署前后端项目.html-B9rRvOCn.js" as="script"><link rel="prefetch" href="/assets/ElasticSearch学习笔记.html-CbCVwrxX.js" as="script"><link rel="prefetch" href="/assets/Redis学习笔记.html-Cy_f1Q20.js" as="script"><link rel="prefetch" href="/assets/CSDN转为Markdown.html-BryCUw21.js" as="script"><link rel="prefetch" href="/assets/栈溢出漏洞原理详解与利用.html-CQ1kqWM_.js" as="script"><link rel="prefetch" href="/assets/FridaHook学习笔记.html-B_GcqIsA.js" as="script"><link rel="prefetch" href="/assets/Windows Defender强制卸载.html-BdhiuQUQ.js" as="script"><link rel="prefetch" href="/assets/404.html-CgQoEdFc.js" as="script"><link rel="prefetch" href="/assets/index.html-tYyhuV7Y.js" as="script"><link rel="prefetch" href="/assets/Friend-mYmx1MaM.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="logo" src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/b_9523abbb426ea0c8a21b2754fdc52300.jpg" alt="不良人"><span class="site-name can-hide" aria-hidden="true">不良人</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习"><span class="title">学习</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习"><span class="title">学习</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/view/note/" aria-label="学习笔记"><!--[--><!--]--> 学习笔记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/view/pigeonhole/" aria-label="归档"><!--[--><!--]--> 归档 <!--[--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/view/work/" aria-label="作品"><!--[--><!--]--> 作品 <!--[--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/view/about/" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习"><span class="title">学习</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习"><span class="title">学习</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/view/note/" aria-label="学习笔记"><!--[--><!--]--> 学习笔记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/view/pigeonhole/" aria-label="归档"><!--[--><!--]--> 归档 <!--[--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/view/work/" aria-label="作品"><!--[--><!--]--> 作品 <!--[--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/view/about/" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="direct3d9入门绘制" tabindex="-1"><a class="header-anchor" href="#direct3d9入门绘制"><span>Direct3D9入门绘制</span></a></h1><p>整个中国对于D3D相关的资料几乎是0，学习成本极其艰巨，为数不多的英语学习书籍也都是主讲3D，用到了很多的3D数学知识。对于2D绘制需求来说学习起来性价比极低，所以专门写了这样一篇D3D9快速入门。</p><h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建"><span>环境搭建</span></a></h2><p>首先要安装Direct3D9的SDK，地址：https://www.microsoft.com/zh-cn/download/details.aspx?id=6812</p><p>下载成功后在VS中导入include和lib目录，目的是拿到，include目录中的d3d9.h、d3dx9.h以及lib目录下的d3d9.lib和d3dx9.lib</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321000410789.png" alt="image-20240321000410789"></p><h2 id="窗口创建" tabindex="-1"><a class="header-anchor" href="#窗口创建"><span>窗口创建</span></a></h2><p>首先要熟悉WIN32应用窗口创建文档：https://learn.microsoft.com/zh-cn/windows/win32/learnwin32/winmain--the-application-entry-point，因为我们的Direct3D窗口是基于Windows窗口上面绘制的。</p><p>先将程序入口由控制台改为窗口</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321000538437.png" alt="image-20240321000538437"></p><p>此时，应用程序入口为WinMain函数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> WINAPI <span class="token function">WinMain</span><span class="token punctuation">(</span>HINSTANCE hInstance<span class="token punctuation">,</span> HINSTANCE hPrevInstance<span class="token punctuation">,</span>PSTR lpCmdLine<span class="token punctuation">,</span> <span class="token keyword">int</span> nCmdShow<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>了解创建窗口参数WNDCLASS类</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">tagWNDCLASSA</span> <span class="token punctuation">{</span>
  UINT      style<span class="token punctuation">;</span>
  WNDPROC   lpfnWndProc<span class="token punctuation">;</span> <span class="token comment">//指向窗口过程的指针</span>
  <span class="token keyword">int</span>       cbClsExtra<span class="token punctuation">;</span>
  <span class="token keyword">int</span>       cbWndExtra<span class="token punctuation">;</span>
  HINSTANCE hInstance<span class="token punctuation">;</span> <span class="token comment">//入口实例</span>
  HICON     hIcon<span class="token punctuation">;</span> <span class="token comment">//图标</span>
  HCURSOR   hCursor<span class="token punctuation">;</span> <span class="token comment">//游标</span>
  HBRUSH    hbrBackground<span class="token punctuation">;</span> <span class="token comment">//背景颜色</span>
  LPCSTR    lpszMenuName<span class="token punctuation">;</span> <span class="token comment">//菜单</span>
  LPCSTR    lpszClassName<span class="token punctuation">;</span> <span class="token comment">//类名</span>
<span class="token punctuation">}</span> WNDCLASSA<span class="token punctuation">,</span> <span class="token operator">*</span>PWNDCLASSA<span class="token punctuation">,</span> <span class="token operator">*</span>NPWNDCLASSA<span class="token punctuation">,</span> <span class="token operator">*</span>LPWNDCLASSA<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>style为窗口风格，如下所示：</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321001122856.png" alt="image-20240321001122856"></p><p>这里要详细了解下lpfnWndProc的定义，后续所有的窗口消息都会传递给Wndproc的第二个参数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>LRESULT <span class="token function">Wndproc</span><span class="token punctuation">(</span>
  HWND unnamedParam1<span class="token punctuation">,</span> <span class="token comment">//窗口句柄</span>
  UINT unnamedParam2<span class="token punctuation">,</span> <span class="token comment">//系统消息列表</span>
  WPARAM unnamedParam3<span class="token punctuation">,</span> <span class="token comment">//其他消息信息</span>
  LPARAM unnamedParam4 <span class="token comment">//其他消息信息</span>
<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>故我们注册一个自己的窗口WNDCLASS类</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>WNDCLASS wc<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>style <span class="token operator">=</span> CS_VREDRAW <span class="token operator">|</span> CS_HREDRAW<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>lpfnWndProc <span class="token operator">=</span> <span class="token punctuation">(</span>WNDPROC<span class="token punctuation">)</span>Wndproc<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>cbClsExtra <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>cbWndExtra <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hInstance <span class="token operator">=</span> hInstance<span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hIcon <span class="token operator">=</span> <span class="token function">LoadIcon</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> IDI_APPLICATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hCursor <span class="token operator">=</span> <span class="token function">LoadCursor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> IDC_ARROW<span class="token punctuation">)</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>hbrBackground <span class="token operator">=</span> <span class="token punctuation">(</span>HBRUSH<span class="token punctuation">)</span><span class="token function">GetStockObject</span><span class="token punctuation">(</span>WHITE_BRUSH<span class="token punctuation">)</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>lpszMenuName <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
wc<span class="token punctuation">.</span>lpszClassName <span class="token operator">=</span> <span class="token string">&quot;ClassName&quot;</span><span class="token punctuation">;</span>
<span class="token function">RegisterClass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来了解创建窗口的函数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>HWND <span class="token function">CreateWindowA</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  lpClassName<span class="token punctuation">,</span> <span class="token comment">//类名</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  lpWindowName<span class="token punctuation">,</span> <span class="token comment">//标题名</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            dwStyle<span class="token punctuation">,</span> <span class="token comment">//窗口风格</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            x<span class="token punctuation">,</span> <span class="token comment">//x坐标</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            y<span class="token punctuation">,</span> <span class="token comment">//y坐标</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            nWidth<span class="token punctuation">,</span> <span class="token comment">//窗口宽度</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">]</span>            nHeight<span class="token punctuation">,</span> <span class="token comment">//窗口高度</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  hWndParent<span class="token punctuation">,</span> <span class="token comment">//父窗口句柄</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  hMenu<span class="token punctuation">,</span> <span class="token comment">//菜单句柄</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  hInstance<span class="token punctuation">,</span> <span class="token comment">//入口实例</span>
  <span class="token punctuation">[</span>in<span class="token punctuation">,</span> optional<span class="token punctuation">]</span>  lpParam <span class="token comment">//传递到窗口的值的指针</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>于是可以创建一个宽和高都为400的窗口</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>HWND hwnd <span class="token operator">=</span> <span class="token function">CreateWindowA</span><span class="token punctuation">(</span><span class="token string">&quot;ClassName&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;窗口标题&quot;</span><span class="token punctuation">,</span>WS_OVERLAPPEDWINDOW<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>wc<span class="token punctuation">.</span>hInstance<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="窗口绘制" tabindex="-1"><a class="header-anchor" href="#窗口绘制"><span>窗口绘制</span></a></h2><p>有了Win32应用窗口，接下来就可以使用Direct3D对窗口进行操作绘制了。</p><p>首先，创建一个D3D9指针，随后再创建一个caps，以及D3D9的参数</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>IDirect3D9<span class="token operator">*</span> d3d9 <span class="token operator">=</span> <span class="token function">Direct3DCreate9</span><span class="token punctuation">(</span>D3D_SDK_VERSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
D3DCAPS9 caps<span class="token punctuation">;</span>
d3d9<span class="token operator">-&gt;</span><span class="token function">GetDeviceCaps</span><span class="token punctuation">(</span>D3DADAPTER_DEFAULT<span class="token punctuation">,</span> D3DDEVTYPE_HAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>caps<span class="token punctuation">)</span><span class="token punctuation">;</span>
D3DPRESENT_PARAMETERS d3dpp<span class="token punctuation">;</span>
<span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d3dpp<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>d3dpp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d3dpp<span class="token punctuation">.</span>Windowed <span class="token operator">=</span> TRUE<span class="token punctuation">;</span> <span class="token comment">//窗口化</span>
d3dpp<span class="token punctuation">.</span>SwapEffect <span class="token operator">=</span> D3DSWAPEFFECT_DISCARD<span class="token punctuation">;</span>
d3dpp<span class="token punctuation">.</span>BackBufferFormat <span class="token operator">=</span> D3DFMT_UNKNOWN<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>随后我们使用d3d9创建一个全局的d3d设备，IDirect3DDevice9* g_device;</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>d3d9<span class="token operator">-&gt;</span><span class="token function">CreateDevice</span><span class="token punctuation">(</span>D3DADAPTER_DEFAULT<span class="token punctuation">,</span> D3DDEVTYPE_HAL<span class="token punctuation">,</span> hwnd<span class="token punctuation">,</span> D3DCREATE_SOFTWARE_VERTEXPROCESSING<span class="token punctuation">,</span> <span class="token operator">&amp;</span>d3dpp<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_device<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>有了win32窗口，有了d3d设备，我们现在要将窗口显示出来。并且循环读入消息。</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token function">ShowWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">UpdateWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">;</span> 
MSG msg<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">,</span>hwnd<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">TranslateMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DispatchMessageA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将消息调度到窗口过程</span>
<span class="token punctuation">}</span>
<span class="token function">UnregisterClass</span><span class="token punctuation">(</span><span class="token string">&quot;ClassName&quot;</span><span class="token punctuation">,</span> wc<span class="token punctuation">.</span>hInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321003642348.png" alt="image-20240321003642348"></p><p>此时我们可以看到一个背景为白色，长宽都为400的窗口。接下来我们只需要对窗口过程WndProc进行编写绘制过程就可以了。</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>VOID <span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> g_device<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	g_device<span class="token operator">-&gt;</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> D3DCLEAR_TARGET<span class="token punctuation">,</span> <span class="token function">D3DCOLOR_ARGB</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">SUCCEEDED</span><span class="token punctuation">(</span>g_device<span class="token operator">-&gt;</span><span class="token function">BeginScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		g_device<span class="token operator">-&gt;</span><span class="token function">EndScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	g_device<span class="token operator">-&gt;</span><span class="token function">Present</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
VOID <span class="token function">CleanUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>g_device <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		g_device<span class="token operator">-&gt;</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
LRESULT WINAPI <span class="token function">Wndproc</span><span class="token punctuation">(</span>
	HWND hwnd<span class="token punctuation">,</span>
	UINT msg<span class="token punctuation">,</span>
	WPARAM wParam<span class="token punctuation">,</span>
	LPARAM lParam
<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
	<span class="token keyword">case</span> WM_DESTROY<span class="token operator">:</span>
        <span class="token function">CleanUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">PostQuitMessage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> WM_PAINT<span class="token operator">:</span>
		<span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ValidateRect</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">DefWindowProc</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> wParam<span class="token punctuation">,</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上Wndproc实现了窗口接收到销毁消息WM_DESTROY时，执行CleanUp函数释放d3d设备。并且实现了窗口接收到绘制消息时，调用d3d设备进行Clear绘制，将窗口底色绘制成ARGB(0,255,200,0)。</p><p><img src="https://wqby-1304194722.cos.ap-nanjing.myqcloud.com/img/image-20240321003734267.png" alt="image-20240321003734267"></p><h2 id="输出文字" tabindex="-1"><a class="header-anchor" href="#输出文字"><span>输出文字</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">//绘制字体</span>
<span class="token keyword">char</span> font<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;微软雅黑&quot;</span><span class="token punctuation">;</span>
<span class="token function">D3DXCreateFont</span><span class="token punctuation">(</span>
	g_device<span class="token punctuation">,</span>
	<span class="token number">40</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>
	FW_BOLD<span class="token punctuation">,</span>
	<span class="token number">1</span><span class="token punctuation">,</span>
	FALSE<span class="token punctuation">,</span>
	DEFAULT_CHARSET<span class="token punctuation">,</span>
	OUT_DEFAULT_PRECIS<span class="token punctuation">,</span>
	DEFAULT_QUALITY<span class="token punctuation">,</span>
	DEFAULT_PITCH<span class="token operator">|</span>FF_DONTCARE<span class="token punctuation">,</span>
	font<span class="token punctuation">,</span> <span class="token comment">//pFaceName</span>
	<span class="token operator">&amp;</span>g_font
<span class="token punctuation">)</span><span class="token punctuation">;</span>
RECT rc<span class="token punctuation">;</span>
<span class="token function">SetRect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_font<span class="token operator">-&gt;</span><span class="token function">DrawTextA</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;输出文字啊啊啊啊阿&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rc<span class="token punctuation">,</span> DT_NOCLIP<span class="token punctuation">,</span> <span class="token function">D3DXCOLOR</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制矩形" tabindex="-1"><a class="header-anchor" href="#绘制矩形"><span>绘制矩形</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">//绘制矩形</span>
D3DRECT d3dRect <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">240</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d3dRect<span class="token punctuation">,</span> D3DCLEAR_TARGET<span class="token punctuation">,</span> <span class="token function">D3DCOLOR_XRGB</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制三角形" tabindex="-1"><a class="header-anchor" href="#绘制三角形"><span>绘制三角形</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">//绘制三角形</span>
LPDIRECT3DVERTEXBUFFER9 g_pVB <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token comment">//三个点的信息</span>
CUSTOMVERTEX vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token punctuation">{</span><span class="token number">150.f</span><span class="token punctuation">,</span><span class="token number">50.f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">1.0f</span><span class="token punctuation">,</span><span class="token number">0xffff0000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">250.0f</span><span class="token punctuation">,</span><span class="token number">250.0f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">1.0f</span><span class="token punctuation">,</span><span class="token number">0xff00ff00</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token number">50.0f</span><span class="token punctuation">,</span><span class="token number">250.0f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">1.0f</span><span class="token punctuation">,</span><span class="token number">0xff00ff00</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">CreateVertexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CUSTOMVERTEX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  D3DFVF_XYZRHW<span class="token operator">|</span>D3DFVF_DIFFUSE<span class="token punctuation">,</span> D3DPOOL_DEFAULT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pVB<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
VOID<span class="token operator">*</span> pVertices<span class="token punctuation">;</span>
g_pVB<span class="token operator">-&gt;</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>pVertices<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memcpy</span><span class="token punctuation">(</span>pVertices<span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_pVB<span class="token operator">-&gt;</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">SetStreamSource</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> g_pVB<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>CUSTOMVERTEX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">SetFVF</span><span class="token punctuation">(</span>D3DFVF_XYZRHW <span class="token operator">|</span> D3DFVF_DIFFUSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
g_device<span class="token operator">-&gt;</span><span class="token function">DrawPrimitive</span><span class="token punctuation">(</span>D3DPT_TRIANGLELIST<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制直线" tabindex="-1"><a class="header-anchor" href="#绘制直线"><span>绘制直线</span></a></h2><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token function">D3DXCreateLine</span><span class="token punctuation">(</span>g_device<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绘制直线</span>
D3DXVECTOR2 Vertex<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
g_Line<span class="token operator">-&gt;</span><span class="token function">SetWidth</span><span class="token punctuation">(</span><span class="token number">5.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g_Line<span class="token operator">-&gt;</span><span class="token function">Draw</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token function">D3DCOLOR_XRGB</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更复杂的3D及动态绘制我也仍在学习阶段，这些就是基本的绘制操作，足以应付外挂编写的基本需求了。</p></blockquote></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CC-6zdNz.js" defer></script>
  </body>
</html>
